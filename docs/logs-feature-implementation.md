# 日志查询功能实现文档

## 功能概述

已成功实现了游戏管理后台的日志查询功能，包括登录日志和对局日志的查询、展示和详情查看。

## 实现的功能

### 1. 登录日志查询页面 (`/logs/login`)
- **搜索功能**: 支持按用户ID和时间范围进行搜索
- **分页展示**: 完整的分页功能，支持页面大小调整
- **详情查看**: 点击详情按钮可查看完整的登录日志信息
- **数据字段**: 日志ID、用户ID、登录渠道、IP地址、设备ID、登录时间、登出时间、在线时长、登录状态

### 2. 对局日志查询页面 (`/logs/game`)
- **搜索功能**: 支持按用户ID和时间范围进行搜索
- **分页展示**: 完整的分页功能，支持页面大小调整
- **详情查看**: 点击详情按钮可查看完整的对局日志信息
- **数据字段**: 日志ID、用户ID、游戏ID、房间ID、游戏模式、对局结果、得分、净收益、开始时间、结束时间、对局时长

### 3. 通用搜索组件 (`LogSearchForm`)
- **用户ID搜索**: 支持数字验证的用户ID输入
- **时间范围选择**: 带预设快捷选项的日期时间范围选择器
- **预设时间**: 今天、昨天、最近3天、最近7天、最近30天
- **搜索验证**: 确保输入有效的搜索条件

### 4. 详情模态框 (`LogDetailModal`)
- **登录日志详情**: 显示完整的登录相关信息
- **对局日志详情**: 显示完整的对局相关信息
- **友好展示**: 时间格式化、状态标签、收益计算等

### 5. 测试页面 (`/logs/test`)
- **功能验证**: 验证日期处理、数据结构等核心功能
- **模拟数据**: 提供示例数据结构预览
- **测试结果**: 显示各项功能的测试状态

## 技术实现

### 1. 前端架构
- **React 19.1.1** + **TypeScript 5.x**: 现代化的前端开发技术栈
- **Ant Design 5.x**: 企业级UI组件库
- **Redux Toolkit**: 状态管理
- **React Router v7**: 路由管理
- **Day.js**: 时间处理库

### 2. API集成
- **日志服务**: 完整的logService API接口封装
- **HTTP客户端**: 基于Axios的统一HTTP请求处理
- **错误处理**: 完善的错误处理和用户提示

### 3. 数据结构
```typescript
// 登录日志
interface LoginLogItem {
  id: number;
  userid: number;
  channel: string;
  ip: string;
  deviceId: string;
  loginTime: string;
  logoutTime: string;
  duration: number;
  status: number;
}

// 对局日志
interface GameLogItem {
  id: number;
  userid: number;
  gameid: number;
  roomid: number;
  gameMode: number;
  result: number;
  score: number;
  winRiches: number;
  loseRiches: number;
  startTime: string;
  endTime: string;
  createTime: string;
}
```

## 页面路由

| 路径 | 页面 | 功能 |
|------|------|------|
| `/logs/login` | 登录日志查询 | 查询和查看用户登录日志 |
| `/logs/game` | 对局日志查询 | 查询和查看用户对局日志 |
| `/logs/test` | 功能测试 | 验证日志功能是否正常 |
| `/logs/stats` | 统计分析 | 预留的统计分析页面 |

## 使用方法

### 1. 访问页面
- 点击侧边栏"日志查询" -> "登录日志"或"对局日志"
- 或直接访问对应的URL路径

### 2. 搜索日志
1. 输入用户ID（可选，必须为数字）
2. 选择时间范围（可选，支持预设快捷选项）
3. 点击"搜索"按钮执行查询
4. 使用"重置"按钮清空搜索条件

### 3. 查看详情
- 点击表格中的"详情"按钮查看完整日志信息
- 模态框中显示所有字段的详细内容

### 4. 分页浏览
- 使用页面底部的分页控件浏览多页数据
- 支持跳转到指定页面和调整每页显示数量

## 后端API要求

### 1. 登录日志API
- **URL**: `GET /api/admin/logs/auth`
- **参数**: userid, startTime, endTime, page, pageSize
- **响应**: 分页的登录日志数据

### 2. 对局日志API
- **URL**: `GET /api/admin/logs/game`
- **参数**: userid, startTime, endTime, page, pageSize
- **响应**: 分页的对局日志数据

### 3. 认证要求
- 所有API请求需要JWT认证
- 请求头自动包含Authorization: Bearer token

## 特性说明

### 1. 响应式设计
- 支持桌面端和移动端显示
- 表格支持横向滚动
- 搜索表单自适应布局

### 2. 用户体验
- 搜索条件验证和提示
- 加载状态指示
- 错误信息显示
- 操作反馈

### 3. 性能优化
- 按需搜索，避免默认加载大量数据
- 分页加载减少单次数据量
- Redux状态管理优化数据流

### 4. 数据展示优化
- 时间格式化显示
- 状态和结果的标签化展示
- 数值的本地化格式（千分位分隔符）
- 收益的颜色区分（正负值）

## 开发说明

### 1. 项目结构
```
src/pages/logs/
├── components/
│   ├── LogSearchForm.tsx      # 搜索表单组件
│   └── LogDetailModal.tsx     # 详情模态框组件
├── LoginLogsPage.tsx          # 登录日志页面
├── GameLogsPage.tsx           # 对局日志页面
├── LogTestPage.tsx            # 测试页面
├── LoginLogsPage.less         # 登录日志样式
├── GameLogsPage.less          # 对局日志样式
└── index.ts                   # 导出文件
```

### 2. 状态管理
- 使用Redux Toolkit管理日志数据状态
- 支持加载状态、错误状态的统一管理
- 提供清空数据的action

### 3. 类型安全
- 完整的TypeScript类型定义
- 严格的类型检查确保代码质量
- 接口和组件的类型一致性

## 注意事项

1. **搜索条件**: 必须提供用户ID或时间范围中的至少一个条件
2. **时间格式**: 使用ISO 8601格式与后端交互
3. **分页**: 前端分页参数需要与后端API契约保持一致
4. **权限**: 确保用户具有日志查询权限
5. **数据量**: 建议设置合理的时间范围以避免大数据量查询

## 后续扩展

1. **导出功能**: 可添加日志数据导出为Excel功能
2. **高级搜索**: 可扩展更多搜索条件
3. **数据可视化**: 在统计分析页面添加图表展示
4. **实时更新**: 可考虑添加自动刷新功能
5. **缓存优化**: 可添加查询结果缓存机制